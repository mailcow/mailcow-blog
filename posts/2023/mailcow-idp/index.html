<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>üîíüîë External Identity Providers for User Authentication - mailcow: dockerized - Blog</title><meta name=author content="Patrick Schult/FreddleSpl0it">
<meta name=description content="Moohoo - Good News, everyone!
With the Nightly Branch, it is now possible to use an external Identity Provider as an additional authentication source.
mailcow utilizes the OIDC (OpenID Connect) protocol to authenticate only mailbox users.
To enable this, we have made some changes to the way authentication works.
Let&rsquo;s talk about what has changed, what we had in mind, and what we plan to add in the future. Of course, we will also show you how to use the new feature.
To make things simpler, I&rsquo;ll use the term IdP (Identity Provider) throughout this post.
"><meta name=keywords content='2023,nightly,ldap,single sign on,sso,keycloak,authentik,identity provider,oidc'><meta itemprop=name content="üîíüîë External Identity Providers for User authentication"><meta itemprop=description content="Moohoo - Good News, everyone!
With the Nightly Branch, it is now possible to use an external Identity Provider as an additional authentication source.
mailcow utilizes the OIDC (OpenID Connect) protocol to authenticate only mailbox users.
To enable this, we have made some changes to the way authentication works.
Let‚Äôs talk about what has changed, what we had in mind, and what we plan to add in the future. Of course, we will also show you how to use the new feature.
To make things simpler, I‚Äôll use the term IdP (Identity Provider) throughout this post."><meta itemprop=datePublished content="2023-08-09T10:24:31+02:00"><meta itemprop=dateModified content="2025-09-10T16:29:56+02:00"><meta itemprop=wordCount content="1654"><meta itemprop=image content="https://mailcow.email/images/cow_mailcow.svg"><meta itemprop=keywords content="2023,Nightly,Ldap,Single Sign On,Sso,Keycloak,Authentik,Identity Provider,Oidc"><meta property="og:url" content="https://mailcow.email/posts/2023/mailcow-idp/"><meta property="og:site_name" content="mailcow: dockerized - Blog"><meta property="og:title" content="üîíüîë External Identity Providers for User authentication"><meta property="og:description" content="Moohoo - Good News, everyone!
With the Nightly Branch, it is now possible to use an external Identity Provider as an additional authentication source.
mailcow utilizes the OIDC (OpenID Connect) protocol to authenticate only mailbox users.
To enable this, we have made some changes to the way authentication works.
Let‚Äôs talk about what has changed, what we had in mind, and what we plan to add in the future. Of course, we will also show you how to use the new feature.
To make things simpler, I‚Äôll use the term IdP (Identity Provider) throughout this post."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-09T10:24:31+02:00"><meta property="article:modified_time" content="2025-09-10T16:29:56+02:00"><meta property="article:tag" content="2023"><meta property="article:tag" content="Nightly"><meta property="article:tag" content="Ldap"><meta property="article:tag" content="Single Sign On"><meta property="article:tag" content="Sso"><meta property="article:tag" content="Keycloak"><meta property="og:image" content="https://mailcow.email/images/cow_mailcow.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mailcow.email/images/cow_mailcow.svg"><meta name=twitter:title content="üîíüîë External Identity Providers for User authentication"><meta name=twitter:description content="Moohoo - Good News, everyone!
With the Nightly Branch, it is now possible to use an external Identity Provider as an additional authentication source.
mailcow utilizes the OIDC (OpenID Connect) protocol to authenticate only mailbox users.
To enable this, we have made some changes to the way authentication works.
Let‚Äôs talk about what has changed, what we had in mind, and what we plan to add in the future. Of course, we will also show you how to use the new feature.
To make things simpler, I‚Äôll use the term IdP (Identity Provider) throughout this post."><meta name=twitter:site content="@mailcow_email"><meta name=twitter:creator content="@mailcow_email"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://mailcow.email/posts/2023/mailcow-idp/ title="üîíüîë External Identity Providers for User authentication - mailcow: dockerized - Blog"><link rel=prev type=text/html href=https://mailcow.email/posts/2023/arm64-open-beta/ title="üí™üêÆ6Ô∏è‚É£4Ô∏è‚É£ mailcow: dockerized (ARM64) is now in open Beta (inside nightly builds)"><link rel=next type=text/html href=https://mailcow.email/posts/2023/release-2023-09/ title="üî•üêÑ Hotfix Update September 2023 (SOGo 5.9.0)"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"üîíüîë External Identity Providers for User authentication","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mailcow.email\/posts\/2023\/mailcow-idp\/"},"genre":"posts","keywords":"2023, nightly, ldap, single sign on, sso, keycloak, authentik, identity provider, oidc","wordcount":1654,"url":"https:\/\/mailcow.email\/posts\/2023\/mailcow-idp\/","datePublished":"2023-08-09T10:24:31+02:00","dateModified":"2025-09-10T16:29:56+02:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Patrick Schult/FreddleSpl0it"},"description":""}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=fixed data-header-mobile=fixed><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="mailcow: dockerized - Blog"><img class=logo src=/images/cow_mailcow.svg alt="mailcow: dockerized - Blog" height=32 width=32><span class=header-title-text>mailcow: dockerized - Blog</span><span class=header-title-post>üì∞</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/>Posts</a></li><li class=menu-item><a class=menu-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-link href=https://mailcow.github.io/mailcow-dockerized-docs/ rel="noopener noreferrer" target=_blank><i class='fa fa-book'></i> Docs</a></li><li class=menu-item><a class=menu-link href=/vps/ title="Verified VPS Providers"><i class='fa fa-server'></i> Verified VPS Providers</a></li><li class=menu-item><a class=menu-link href="https://www.servercow.de/mailcow?lang=en#support" title="Buy Support" rel="noopener noreferrer" target=_blank><i class='fas fa-band-aid'></i> Support</a></li><li class=menu-item><a class=menu-link href=https://github.com/mailcow/mailcow-dockerized title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i> GitHub</a></li><li class="menu-item has-children"><a class=menu-link href=https://demo.mailcow.email title=Demos rel="noopener noreferrer" target=_blank><i class='fa fa-play'></i> Demos</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=https://demo.mailcow.email title="Stable Demo" rel="noopener noreferrer" target=_blank>‚úÖ Stable Demo</a></li><li class=menu-item><a class=menu-link href=https://nightly-demo.mailcow.email title="Nightly Demo" rel="noopener noreferrer" target=_blank>üõ†Ô∏è Nightly Demo</a></li></ul></li><li class="menu-item has-children"><a class=menu-link href=https://mailcow.email title=Sponsoring rel="noopener noreferrer" target=_blank><i class='fa fa-heart'></i> Sponsor the Project</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href="https://www.servercow.de/mailcow?lang=en#sal" title="Buy a SAL (One Time Payment)" rel="noopener noreferrer" target=_blank>‚ù§Ô∏è Buy a Stay Awesome License</a></li><li class=menu-item><a class=menu-link href=https://github.com/sponsors/mailcow title="Sponsor mailcow on GitHub" rel="noopener noreferrer" target=_blank>üß° Sponsor us directly on GitHub</a></li></ul></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Select Language" title="Select Language"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><span class=text-secondary title=English>English</span></li><li class=menu-item><a href=/de/posts/2023/mailcow-idp/ class=menu-link title=Deutsch>Deutsch</a></li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="mailcow: dockerized - Blog"><img class=logo src=/images/cow_mailcow.svg alt="mailcow: dockerized - Blog" height=26 width=26><span class=header-title-text>mailcow: dockerized - Blog</span><span class=header-title-post>üì∞</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=menu-item><a class=menu-link href=/posts/>Posts</a></li><li class=menu-item><a class=menu-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-link href=https://mailcow.github.io/mailcow-dockerized-docs/ rel="noopener noreferrer" target=_blank><i class='fa fa-book'></i> Docs</a></li><li class=menu-item><a class=menu-link href=/vps/ title="Verified VPS Providers"><i class='fa fa-server'></i> Verified VPS Providers</a></li><li class=menu-item><a class=menu-link href="https://www.servercow.de/mailcow?lang=en#support" title="Buy Support" rel="noopener noreferrer" target=_blank><i class='fas fa-band-aid'></i> Support</a></li><li class=menu-item><a class=menu-link href=https://github.com/mailcow/mailcow-dockerized title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i> GitHub</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=https://demo.mailcow.email title=Demos rel="noopener noreferrer" target=_blank><i class='fa fa-play'></i> Demos</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=https://demo.mailcow.email title="Stable Demo" rel="noopener noreferrer" target=_blank>‚úÖ Stable Demo</a></li><li class=menu-item><a class=menu-link href=https://nightly-demo.mailcow.email title="Nightly Demo" rel="noopener noreferrer" target=_blank>üõ†Ô∏è Nightly Demo</a></li></ul></li><li class=menu-item><span class=nested-item><a class=menu-link href=https://mailcow.email title=Sponsoring rel="noopener noreferrer" target=_blank><i class='fa fa-heart'></i> Sponsor the Project</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href="https://www.servercow.de/mailcow?lang=en#sal" title="Buy a SAL (One Time Payment)" rel="noopener noreferrer" target=_blank>‚ù§Ô∏è Buy a Stay Awesome License</a></li><li class=menu-item><a class=menu-link href=https://github.com/sponsors/mailcow title="Sponsor mailcow on GitHub" rel="noopener noreferrer" target=_blank>üß° Sponsor us directly on GitHub</a></li></ul></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Select Language" title="Select Language">English<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option value=/posts/2023/mailcow-idp/ selected disabled>English</option><option value=/de/posts/2023/mailcow-idp/>Deutsch</option></select></span></li></ul></nav></div></header><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Collections></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>üîíüîë External Identity Providers for User Authentication</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Patrick Schult/FreddleSpl0it</span></span><span class=post-included-in>&nbsp;included in <a href=/categories/news/ class=post-category title="Category - News"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> News</a></span></div><div class=post-meta-line><span title="published on 2023-08-09 10:24:31"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=08-09-2023>08-09-2023</time></span>&nbsp;<span title="Updated on 2025-09-10 16:29:56"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=09-10-2025>09-10-2025</time></span>&nbsp;<span title="1654 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>About 1700 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>8 minutes</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#what-has-been-changed-and-why>What has been changed and why?</a><ul><li><a href=#mailcow-ui>mailcow UI</a></li><li><a href=#dovecot>Dovecot</a></li><li><a href=#sogo>SOGo</a></li><li><a href=#app-links>App Links</a></li></ul></li><li><a href=#ideas-for-the-future>Ideas for the future</a></li><li><a href=#how-do-i-use-this-feature>How do I use this feature?</a><ul><li><a href=#keycloak-configuration>Keycloak Configuration</a><ul><li><a href=#step-1>Step 1</a></li><li><a href=#step-2>Step 2</a></li><li><a href=#step-3>Step 3</a></li><li><a href=#step-4>Step 4</a></li></ul></li><li><a href=#mailcow-configuration>mailcow Configuration</a><ul><li><a href=#step-1-1>Step 1</a></li><li><a href=#step-2-1>Step 2</a></li></ul></li><li><a href=#create-test-user>Create Test User</a></li><li><a href=#change-idp-for-existing-mailbox-users>Change IdP for existing mailbox users</a></li><li><a href=#automatic-user-provisioning>Automatic User Provisioning</a><ul><li><a href=#step-1-2>Step 1</a></li><li><a href=#step-2-2>Step 2</a></li><li><a href=#step-3-1>Step 3</a></li><li><a href=#mailpassword-flow>Mailpassword Flow</a></li></ul></li><li><a href=#ldap>LDAP</a></li></ul></li><li><a href=#in-conclusion>In conclusion</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><strong>Moohoo - Good News, everyone!</strong></p><p>With the Nightly Branch, it is now possible to use an external Identity Provider as an additional authentication source.<br>mailcow utilizes the OIDC (OpenID Connect) protocol to authenticate only mailbox users.<br>To enable this, we have made some changes to the way authentication works.<br><br></p><p>Let&rsquo;s talk about what has changed, what we had in mind, and what we plan to add in the future. Of course, we will also show you how to use the new feature.<br>To make things simpler, I&rsquo;ll use the term <code>IdP</code> (Identity Provider) throughout this post.<br><br><br></p><h3 class=heading-element id=what-has-been-changed-and-why><span>What has been changed and why?</span>
<a href=#what-has-been-changed-and-why class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Our goal was to enable the use of an IdP alongside the existing SQL database as an authentication source. However, <strong>only one IdP</strong> can be configured at a time, and multiple ones are not supported.<br>Now, mailcow needs to be able to decide, depending on the user, which authentication source should be used. To make this possible, we have made changes to the services mailcow UI (phpfpm), Dovecot, and SOGo.</p><h4 class=heading-element id=mailcow-ui><span>mailcow UI</span>
<a href=#mailcow-ui class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>We have outsourced the entire authentication logic to the phpfpm service. For each user, an authentication source is now defined, which can currently be either mailcow, Keycloak, or Generic-OIDC. During login, mailcow then uses the corresponding source for authentication.</p><h4 class=heading-element id=dovecot><span>Dovecot</span>
<a href=#dovecot class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Until now, Dovecot has been using a custom LUA script for authentication, which used SQL queries. Instead of SQL queries, HTTP requests to an internally available PHP script are now used.<br>Users who authenticate via the IdP <strong>must create App passwords</strong> to continue using mail clients like Thunderbird.<br>There is another option available to avoid creating additional App passwords, but this is only applicable for the Keycloak provider.<br>I&rsquo;ll explain that later.</p><h4 class=heading-element id=sogo><span>SOGo</span>
<a href=#sogo class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Many might have wondered why the mailcow login is displayed under the root path instead of the SOGo login.
For the SOGo login, there has been a Proxy Auth feature available for quite some time, which can be used from the mailcow UI.
With the Proxy Auth feature, logged-in users can be redirected to SOGo without needing to log in again. This allows users to access additional features beforehand, such as password change, app passwords, temporary aliases, etc.
To highlight this feature more prominently, we have redesigned the mailcow UI and placed a noticeable blue button at the top that nobody should overlook.
Users who use the IdP can only log in to SOGo through the mailcow UI. <strong>Directly logging in through SOGo will not work.</strong></p><h4 class=heading-element id=app-links><span>App Links</span>
<a href=#app-links class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>As direct login through SOGo does not work for IdP users, we have extended the app links to avoid confusion in the future.
App links can now be either hidden or displayed for the login. The default linking to SOGo in the mailcow login is hidden. However, logged-in users will still see all the apps.
Furthermore, an additional link can be entered for logged-in users, using <code>%u</code> as a placeholder for the username. For example, logged-in users can be redirected to the Proxy Auth script with <code>/sogo-auth.php?login=%u</code> using an app link.<br><br></p><div style=text-align:center><img src=images/sso_mailcow5.png></div><br><br><br><h3 class=heading-element id=ideas-for-the-future><span>Ideas for the future</span>
<a href=#ideas-for-the-future class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>In the future, we may consider allowing you to customize the post-login redirection for individual users, giving you the flexibility to choose whether they should be directed to mailcow or SOGo after logging in.<br>Additionally, as a result of the authentication overhaul, we have now separated the login functions for Admins, Domain Admins, Users, and App Passwords. One potential idea is to offer different login paths for Admins, Domain Admins, and Users, which would also involve dividing the API into distinct Admin, Domain Admin, and User APIs.<br>Building on this foundation, we could explore the possibility of adding more OIDC providers if the Generic-OIDC option proves insufficient. Alternatively, we might even consider directly integrating an LDAP provider.
Please note that these are just some potential ideas for future development.<br><br><br></p><h3 class=heading-element id=how-do-i-use-this-feature><span>How do I use this feature?</span>
<a href=#how-do-i-use-this-feature class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Firstly, I want to mention that in our tests, we have only tested Keycloak as an IdP. However, it is also possible to set up other IdPs (Generic-OIDC). If you are already using a different IdP, such as Authentik, we would appreciate your feedback.<br><br>The prerequisite for this guide is that you already have a running Keycloak instance.<br></p><p>For this example, we will use the following setup:</p><ul><li>Keycloak as the IdP</li><li>Keycloak instance accessible at <a href=https://mail.cow.tld/auth target=_blank rel="external nofollow noopener noreferrer">https://mail.cow.tld/auth</a></li><li>mailcow instance accessible at <a href=https://mail.cow.tld target=_blank rel="external nofollow noopener noreferrer">https://mail.cow.tld</a></li><li>We use <code>cow.tld</code> as the domain for our emails</li><li>In Keycloak, we use <code>mailcow</code> as the Realm.</li></ul><br><h4 class=heading-element id=keycloak-configuration><span>Keycloak Configuration</span>
<a href=#keycloak-configuration class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=step-1><span>Step 1</span>
<a href=#step-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Install the mailcow Nightly version on a test instance.<br><a href=https://docs.mailcow.email/i_u_m/i_u_m_update/#best-practice-nightly-update target=_blank rel="external nofollow noopener noreferrer">https://docs.mailcow.email/i_u_m/i_u_m_update/#best-practice-nightly-update</a></p><h5 class=heading-element id=step-2><span>Step 2</span>
<a href=#step-2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Log in as an Admin to Keycloak and navigate to your Realm or create one.<br>In the Realm, we will now create a new client named <code>mailcow</code> and configure it as follows:</p><div style="text-align:center;margin:30px 0"><img src=images/sso_keycloak1.png>
<img src=images/sso_keycloak2.png>
<img src=images/sso_keycloak3.png></div><h5 class=heading-element id=step-3><span>Step 3</span>
<a href=#step-3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>After saving the client, we need to include a User Attribute in the <code>token claim</code>. The User Attribute is named <code>mailcow_template</code>, and with the following settings, it will be included in the OIDC Endpoint <code>/userinfo</code>. Based on this attribute, the mailbox configuration will be determined (quota, ACLs, etc.).</p><div style="text-align:center;margin:30px 0"><img src=images/sso_keycloak4.png>
<img src=images/sso_keycloak5.png>
<img src=images/sso_keycloak6.png>
<img src=images/sso_keycloak7.png></div><h5 class=heading-element id=step-4><span>Step 4</span>
<a href=#step-4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Now we can copy the Client Secret from the Client Configuration and proceed with mailcow.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_keycloak8.png></div><p><br><br><br></p><h4 class=heading-element id=mailcow-configuration><span>mailcow Configuration</span>
<a href=#mailcow-configuration class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><h5 class=heading-element id=step-1-1><span>Step 1</span>
<a href=#step-1-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Log in to mailcow and navigate to System -> Configuration -> Access -> Identity Provider. Fill in the fields accordingly.<br>The Keycloak version can be found in the Admin Dashboard under the master Realm. It is essential to know whether a version greater or smaller than 20 is used since mailcow needs to add the &ldquo;openid&rdquo; scope accordingly.<br>The Attribute Mapping is used by mailcow to apply the mapped mailbox template based on the Keycloak User Attribute <code>mailcow_template</code>.
For this example, I haven&rsquo;t created an extra template, so we will set up a mapping to the Default template.<br>We can ignore everything beyond the Attribute Mapping for now.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_mailcow1.png></div><h5 class=heading-element id=step-2-1><span>Step 2</span>
<a href=#step-2-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>The settings can be tested before saving. If the test fails, please check whether mailcow can reach the specified server URL and verify that the Realm, Client ID, and Client Secret information are correct.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_mailcow2.png></div><p><br><br><br></p><h4 class=heading-element id=create-test-user><span>Create Test User</span>
<a href=#create-test-user class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Now, let&rsquo;s proceed to add a user in Keycloak. Go back to the Keycloak Admin Dashboard and select your Realm.
Then, navigate to Users and add the new user.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_keycloak9.png></div><p>Afterwards, let&rsquo;s specify that the user should receive a <code>default mailbox</code>.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_keycloak10.png>
<img src=images/sso_keycloak11.png></div><p>Finally, don&rsquo;t forget to set a password for the new user under the <code>Credentials</code> tab, and you&rsquo;re done.<br></p><p>With our current configuration, the new user does not exist directly in mailcow. However, this will happen automatically during the first login.
Go to the mailcow login and click on the SSO button in the dropdown. This will redirect you to Keycloak.
If the Keycloak login works, but you end up back at the mailcow login with an error message, please make sure that the domain exists and that mailboxes can be created under that domain.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_mailcow3.png></div><p>Everything should work now, and you should be logged in, landing on the new user page. I believe you can&rsquo;t miss the &ldquo;Login to webmail&rdquo; button. Additionally, you&rsquo;ll notice that there are no configuration options for password change or 2FA displayed here since these are configured through Keycloak.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_mailcow4.png></div><p>If you want to use a mail client like Thunderbird with this user, you can create an app password under App Passwords accordingly.</p><p><br><br><br></p><h4 class=heading-element id=change-idp-for-existing-mailbox-users><span>Change IdP for existing mailbox users</span>
<a href=#change-idp-for-existing-mailbox-users class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>The IdP for existing mailbox users can be changed. Make sure the user exists in the IdP and simply edit the mailbox in mailcow and select the IdP you want.
If you switch back to mailcow as IdP, it will reuse the old password.</p><div style="text-align:center;margin:30px 0"><img src=images/sso_mailcow6.png></div><p><br><br><br></p><h4 class=heading-element id=automatic-user-provisioning><span>Automatic User Provisioning</span>
<a href=#automatic-user-provisioning class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>Keycloak, as an IdP, can be configured in mailcow to control changes for all users at a custom interval. This allows users to be automatically created, and even when the <code>mailcow_template</code> is modified later, attributes will be adjusted automatically. To configure this, the mailcow client needs additional permissions in Keycloak. Specifically, the client requires the <code>view-users</code> permission. With this permission, all Realm users can be queried through the Keycloak Admin REST API.</p><h5 class=heading-element id=step-1-2><span>Step 1</span>
<a href=#step-1-2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Log in as an Admin to Keycloak, go to your Realm, and edit the mailcow client.</p><div style=text-align:center><img src=images/sso_keycloak12.png>
<img src=images/sso_keycloak13.png></div><h5 class=heading-element id=step-2-2><span>Step 2</span>
<a href=#step-2-2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>In the mailcow UI, under Identity Provider, enable <code>Periodic Full Sync</code> and <code>Import Users</code>. Then, select your desired interval in minutes and save.
<code>Periodic Full Sync</code> checks if the <code>mailcow_template</code> attribute has changed and adjusts the mailbox accordingly.
<code>Import Users</code> checks if new users have been created and also creates them in mailcow.</p><h5 class=heading-element id=step-3-1><span>Step 3</span>
<a href=#step-3-1 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>Under System -> Information -> Logs -> Crontasks, you will find all logs related to automatic user provisioning. If something doesn&rsquo;t work as expected, you can find more information there.</p><h5 class=heading-element id=mailpassword-flow><span>Mailpassword Flow</span>
<a href=#mailpassword-flow class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h5><p>As described in the info text below the option, the Mailpassword Flow can be used to authenticate the user using the Keycloak attribute <code>mailcow_password</code>. This password can also be used directly for the mailcow UI and mail clients.<br>For this to work, the mailcow client must have the <code>view-users</code> permission, as described above, and the attribute <code>mailcow_password</code> must be included in the <code>token claim</code>, as described above.
You can now add the attribute <code>mailcow_password</code> to the user in Keycloak.
The password should be hashed and have one of the following formats: <a href=https://docs.mailcow.email/models/model-passwd/ target=_blank rel="external nofollow noopener noreferrer">https://docs.mailcow.email/models/model-passwd/</a>
Here is an example of the standard <code>moohoo</code> password: <code>{SSHA256}K8eVJ6YsZbQCfuJvSUbaQRLr0HPLz5rC9IAp0PAFl0tmNDBkMDc0NDAyOTAxN2Rk</code></p><p><br><br><br></p><h4 class=heading-element id=ldap><span>LDAP</span>
<a href=#ldap class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>In Keycloak, you can connect an LDAP provider in your Realm under <code>User Federation</code>.
<a href=https://www.keycloak.org/docs/latest/server_admin/#_ldap target=_blank rel="external nofollow noopener noreferrer">https://www.keycloak.org/docs/latest/server_admin/#_ldap</a><br><br>After configuring, the <code>mailcow_template</code> attribute needs to be mapped. If desired, you can also map the <code>mailcow_password</code> attribute using the same procedure.
With the following configuration, we map the LDAP attribute <code>mailboxType</code> to the Keycloak attribute <code>mailcow_template</code>. If no value for <code>mailcow_template</code> is present, we force it to be <code>default</code>.</p><div style=text-align:center><img src=images/sso_keycloak14.png>
<img src=images/sso_keycloak15.png></div><p><br><br><br></p><h3 class=heading-element id=in-conclusion><span>In conclusion</span>
<a href=#in-conclusion class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p><strong>The authentication has undergone significant changes. When testing, pay special attention to security vulnerabilities.</strong><br><strong>Otherwise, we can say: Enjoy testing! We look forward to your feedback and bug reports.</strong><br><span style="font-size:3rem;margin:20px 0;display:block">üêÆ</span></p><br><hr><p>Stay healthy and happy mailing!</p><p>Your mailcow Team</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2025-09-10 16:29:56">Updated on 09-10-2025&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/2023/ class=post-tag title="Tags - 2023">2023</a><a href=/tags/nightly/ class=post-tag title="Tags - Nightly">Nightly</a><a href=/tags/ldap/ class=post-tag title="Tags - Ldap">Ldap</a><a href=/tags/single-sign-on/ class=post-tag title="Tags - Single Sign On">Single Sign On</a><a href=/tags/sso/ class=post-tag title="Tags - Sso">Sso</a><a href=/tags/keycloak/ class=post-tag title="Tags - Keycloak">Keycloak</a><a href=/tags/authentik/ class=post-tag title="Tags - Authentik">Authentik</a><a href=/tags/identity-provider/ class=post-tag title="Tags - Identity Provider">Identity Provider</a><a href=/tags/oidc/ class=post-tag title="Tags - Oidc">Oidc</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2023/arm64-open-beta/ class=post-nav-item rel=prev title="üí™üêÆ6Ô∏è‚É£4Ô∏è‚É£ Mailcow: Dockerized (ARM64) Is Now in Open Beta (Inside Nightly Builds)"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>üí™üêÆ6Ô∏è‚É£4Ô∏è‚É£ Mailcow: Dockerized (ARM64) Is Now in Open Beta (Inside Nightly Builds)</a><a href=/posts/2023/release-2023-09/ class=post-nav-item rel=next title="üî•üêÑ Hotfix Update September 2023 (SOGo 5.9.0)">üî•üêÑ Hotfix Update September 2023 (SOGo 5.9.0)<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label=Contents><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.3"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Theme - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.21-a85a6655"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2016 - 2025</span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://tinc.gmbh?kontakt target=_blank>The Infrastructure Company GmbH</a></span></div><div class="footer-line beian"><span class="icp footer-divider"><a href=/imprint/>Imprint</a> | <a href=/policy/>Privacy Policy</a></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div></div><div id=mask></div><noscript><div class=noscript-warning>This website works best with JavaScript enabled.</div></noscript></div><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script>window.config={code:{copyTitle:"Copy to clipboard",editLockTitle:"Lock editable code block",editUnLockTitle:"Unlock editable code block",editable:!0,maxShownLines:10},comment:{enable:!1},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},version:"v0.3.21-a85a6655"}</script><script src=/js/theme.min.js defer></script></body></html>